<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Website with Genesys Embeddable Framework</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-bottom: 2rem;
            border-radius: 8px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .content-area {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .genesys-panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .genesys-header {
            background-color: #3498db;
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: bold;
        }

        #genesys-frame {
            width: 100%;
            height: 600px;
            border: none;
            display: block;
        }

        .click-to-dial-demo {
            background: #ecf0f1;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .phone-number {
            background-color: #3498db;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .phone-number:hover {
            background-color: #2980b9;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #95a5a6;
            margin-right: 8px;
        }

        .status-indicator.connected {
            background-color: #27ae60;
        }

        .status-indicator.disconnected {
            background-color: #e74c3c;
        }

        .customer-info {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .customer-info h3 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
            border-bottom: 1px solid #eee;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .footer {
            background-color: #34495e;
            color: white;
            text-align: center;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .genesys-panel {
                order: -1;
            }
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            border: 1px solid #c3e6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Customer Service Portal</h1>
            <p>Integrated with Genesys Cloud Contact Center</p>
        </header>

        <div class="main-content">
            <div class="content-area">
                <h2>Customer Information</h2>
                
                <div class="customer-info">
                    <h3>Current Customer: John Smith</h3>
                    <div class="info-row">
                        <span><strong>Customer ID:</strong></span>
                        <span>CUST-12345</span>
                    </div>
                    <div class="info-row">
                        <span><strong>Phone:</strong></span>
                        <span>(555) 123-4567</span>
                    </div>
                    <div class="info-row">
                        <span><strong>Email:</strong></span>
                        <span>john.smith@email.com</span>
                    </div>
                    <div class="info-row">
                        <span><strong>Account Status:</strong></span>
                        <span>Active</span>
                    </div>
                </div>

                <div class="click-to-dial-demo">
                    <h3>Click-to-Dial Demo</h3>
                    <p>Click any phone number below to initiate a call through Genesys:</p>
                    <br>
                    <button class="phone-number" onclick="initiateCall('5551234567')">
                        ðŸ“ž (555) 123-4567 - Customer Service
                    </button>
                    <button class="phone-number" onclick="initiateCall('5559876543')">
                        ðŸ“ž (555) 987-6543 - Sales Team
                    </button>
                    <button class="phone-number" onclick="initiateCall('5555551234')">
                        ðŸ“ž (555) 555-1234 - Technical Support
                    </button>
                </div>

                <div class="customer-info">
                    <h3>Recent Interactions</h3>
                    <div class="info-row">
                        <span>Last Call:</span>
                        <span>Sept 15, 2025 - 3:30 PM</span>
                    </div>
                    <div class="info-row">
                        <span>Duration:</span>
                        <span>8 minutes 32 seconds</span>
                    </div>
                    <div class="info-row">
                        <span>Resolution:</span>
                        <span>Account Updated</span>
                    </div>
                </div>

                <div id="status-messages">
                    <!-- Dynamic status messages will appear here -->
                </div>
            </div>

            <div class="genesys-panel">
                <div class="genesys-header">
                    <span class="status-indicator" id="connection-status"></span>
                    Genesys Cloud Agent Desktop
                </div>
                
                <!-- Replace the src URL with your actual Genesys Cloud region and client ID -->
                <iframe 
                    id="genesys-frame"
                    src="https://apps.usw2.pure.cloud/crm/embeddableFramework.html?clientId=9f4ef35c-6cf3-4d6c-8abe-1cca6f15fa3a"
                    allow="camera *; autoplay *; microphone *; geolocation *"
                    title="Genesys Cloud Embeddable Framework">
                </iframe>
            </div>
        </div>

        <footer class="footer">
            <p>&copy; 2025 Your Company Name. Powered by Genesys Cloud.</p>
        </footer>
    </div>

    <script>
        // Configuration - Replace with your actual domain
        const ALLOWED_ORIGIN = 'https://apps.usw2.pure.cloud';
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded - initializing Genesys integration');
            updateConnectionStatus('connecting');
            
            // Simulate connection after a delay
            setTimeout(() => {
                updateConnectionStatus('connected');
                showMessage('Successfully connected to Genesys Cloud', 'success');
            }, 3000);
        });

        // Click-to-dial functionality
        function initiateCall(phoneNumber) {
            console.log('Initiating call to:', phoneNumber);
            
            // Format the phone number
            const formattedNumber = formatPhoneNumber(phoneNumber);
            
            // Send message to Genesys embeddable framework
            const genesysFrame = document.getElementById('genesys-frame');
            if (genesysFrame) {
                const message = {
                    type: 'clickToDial',
                    data: {
                        number: phoneNumber,
                        formatted: formattedNumber
                    }
                };
                
                genesysFrame.contentWindow.postMessage(message, ALLOWED_ORIGIN);
                showMessage(`Initiating call to ${formattedNumber}`, 'success');
            } else {
                showMessage('Genesys framework not available', 'error');
            }
        }

        // Listen for messages from the embedded framework
        window.addEventListener('message', function(event) {
            // Validate origin for security
            if (event.origin !== ALLOWED_ORIGIN) {
                console.warn('Message from unauthorized origin:', event.origin);
                return;
            }

            const message = event.data;
            console.log('Received message from Genesys framework:', message);

            // Handle different message types
            switch (message.type) {
                case 'callStateChanged':
                    handleCallStateChanged(message.data);
                    break;
                case 'agentStateChanged':
                    handleAgentStateChanged(message.data);
                    break;
                case 'interactionEvent':
                    handleInteractionEvent(message.data);
                    break;
                default:
                    console.log('Unknown message type:', message.type);
            }
        });

        // Handle call state changes
        function handleCallStateChanged(callData) {
            console.log('Call state changed:', callData);
            
            if (callData.state === 'connected') {
                updateConnectionStatus('connected');
                showMessage('Call connected successfully', 'success');
            } else if (callData.state === 'disconnected') {
                updateConnectionStatus('disconnected');
                showMessage('Call ended', 'info');
            }
        }

        // Handle agent state changes
        function handleAgentStateChanged(agentData) {
            console.log('Agent state changed:', agentData);
            
            if (agentData.state === 'available') {
                updateConnectionStatus('connected');
            } else if (agentData.state === 'unavailable') {
                updateConnectionStatus('disconnected');
            }
        }

        // Handle interaction events
        function handleInteractionEvent(interactionData) {
            console.log('Interaction event:', interactionData);
            
            // Update customer information based on incoming call data
            if (interactionData.phoneNumber) {
                showMessage(`Incoming interaction from ${formatPhoneNumber(interactionData.phoneNumber)}`, 'info');
            }
        }

        // Update connection status indicator
        function updateConnectionStatus(status) {
            const indicator = document.getElementById('connection-status');
            indicator.className = `status-indicator ${status}`;
        }

        // Show status messages
        function showMessage(message, type = 'info') {
            const messagesContainer = document.getElementById('status-messages');
            const messageDiv = document.createElement('div');
            
            let className = 'success-message';
            if (type === 'error') className = 'error-message';
            if (type === 'info') className = 'success-message';
            
            messageDiv.className = className;
            messageDiv.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            
            messagesContainer.appendChild(messageDiv);
            
            // Remove message after 5 seconds
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Format phone number for display
        function formatPhoneNumber(number) {
            const cleaned = number.toString().replace(/\D/g, '');
            if (cleaned.length === 10) {
                return `(${cleaned.substring(0,3)}) ${cleaned.substring(3,6)}-${cleaned.substring(6)}`;
            } else if (cleaned.length === 11 && cleaned[0] === '1') {
                return `+1 (${cleaned.substring(1,4)}) ${cleaned.substring(4,7)}-${cleaned.substring(7)}`;
            }
            return number;
        }

        // Error handling for iframe loading
        document.getElementById('genesys-frame').addEventListener('error', function() {
            showMessage('Failed to load Genesys framework. Please check your configuration.', 'error');
            updateConnectionStatus('disconnected');
        });

        // Send custom data to framework (example)
        function sendCustomerData(customerData) {
            const genesysFrame = document.getElementById('genesys-frame');
            if (genesysFrame) {
                const message = {
                    type: 'customerData',
                    data: customerData
                };
                genesysFrame.contentWindow.postMessage(message, ALLOWED_ORIGIN);
            }
        }

        // Example: Send current customer data to framework
        setTimeout(() => {
            sendCustomerData({
                customerId: 'CUST-12345',
                name: 'John Smith',
                phone: '5551234567',
                email: 'john.smith@email.com',
                accountStatus: 'Active'
            });
        }, 5000);
    </script>
</body>
</html>
